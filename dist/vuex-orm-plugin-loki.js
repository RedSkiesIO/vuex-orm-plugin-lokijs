!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["vuex-orm-plugin-loki"]=e():t["vuex-orm-plugin-loki"]=e()}(window,function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=12)}([function(t,e,i){var r;t.exports=(r=r||function(t,e){var i=Object.create||function(){function t(){}return function(e){var i;return t.prototype=e,i=new t,t.prototype=null,i}}(),r={},n=r.lib={},o=n.Base={extend:function(t){var e=i(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},s=n.WordArray=o.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,i=t.words,r=this.sigBytes,n=t.sigBytes;if(this.clamp(),r%4)for(var o=0;o<n;o++){var s=i[o>>>2]>>>24-o%4*8&255;e[r+o>>>2]|=s<<24-(r+o)%4*8}else for(var o=0;o<n;o+=4)e[r+o>>>2]=i[o>>>2];return this.sigBytes+=n,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-i%4*8,e.length=t.ceil(i/4)},clone:function(){var t=o.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var i,r=[],n=function(e){var e=e,i=987654321,r=4294967295;return function(){var n=((i=36969*(65535&i)+(i>>16)&r)<<16)+(e=18e3*(65535&e)+(e>>16)&r)&r;return n/=4294967296,(n+=.5)*(t.random()>.5?1:-1)}},o=0;o<e;o+=4){var a=n(4294967296*(i||t.random()));i=987654071*a(),r.push(4294967296*a()|0)}return new s.init(r,e)}}),a=r.enc={},l=a.Hex={stringify:function(t){for(var e=t.words,i=t.sigBytes,r=[],n=0;n<i;n++){var o=e[n>>>2]>>>24-n%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,i=[],r=0;r<e;r+=2)i[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new s.init(i,e/2)}},c=a.Latin1={stringify:function(t){for(var e=t.words,i=t.sigBytes,r=[],n=0;n<i;n++){var o=e[n>>>2]>>>24-n%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(t){for(var e=t.length,i=[],r=0;r<e;r++)i[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new s.init(i,e)}},h=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},u=n.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=h.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var i=this._data,r=i.words,n=i.sigBytes,o=this.blockSize,a=4*o,l=n/a,c=(l=e?t.ceil(l):t.max((0|l)-this._minBufferSize,0))*o,h=t.min(4*c,n);if(c){for(var u=0;u<c;u+=o)this._doProcessBlock(r,u);var d=r.splice(0,c);i.sigBytes-=h}return new s.init(d,h)},clone:function(){var t=o.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),d=(n.Hasher=u.extend({cfg:o.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var e=this._doFinalize();return e},blockSize:16,_createHelper:function(t){return function(e,i){return new t.init(i).finalize(e)}},_createHmacHelper:function(t){return function(e,i){return new d.HMAC.init(t,i).finalize(e)}}}),r.algo={});return r}(Math),r)},function(t,e,i){var r;t.exports=(r=i(0),i(7),i(8),i(2),i(11),function(){var t=r,e=t.lib.BlockCipher,i=t.algo,n=[],o=[],s=[],a=[],l=[],c=[],h=[],u=[],d=[],p=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;var i=0,r=0;for(e=0;e<256;e++){var f=r^r<<1^r<<2^r<<3^r<<4;f=f>>>8^255&f^99,n[i]=f,o[f]=i;var y=t[i],v=t[y],g=t[v],m=257*t[f]^16843008*f;s[i]=m<<24|m>>>8,a[i]=m<<16|m>>>16,l[i]=m<<8|m>>>24,c[i]=m,m=16843009*g^65537*v^257*y^16843008*i,h[f]=m<<24|m>>>8,u[f]=m<<16|m>>>16,d[f]=m<<8|m>>>24,p[f]=m,i?(i=y^t[t[t[g^y]]],r^=t[t[r]]):i=r=1}}();var f=[0,1,2,4,8,16,32,64,128,27,54],y=i.AES=e.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,i=t.sigBytes/4,r=4*((this._nRounds=i+6)+1),o=this._keySchedule=[],s=0;s<r;s++)if(s<i)o[s]=e[s];else{var a=o[s-1];s%i?i>6&&s%i==4&&(a=n[a>>>24]<<24|n[a>>>16&255]<<16|n[a>>>8&255]<<8|n[255&a]):(a=n[(a=a<<8|a>>>24)>>>24]<<24|n[a>>>16&255]<<16|n[a>>>8&255]<<8|n[255&a],a^=f[s/i|0]<<24),o[s]=o[s-i]^a}for(var l=this._invKeySchedule=[],c=0;c<r;c++)s=r-c,a=c%4?o[s]:o[s-4],l[c]=c<4||s<=4?a:h[n[a>>>24]]^u[n[a>>>16&255]]^d[n[a>>>8&255]]^p[n[255&a]]}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,s,a,l,c,n)},decryptBlock:function(t,e){var i=t[e+1];t[e+1]=t[e+3],t[e+3]=i,this._doCryptBlock(t,e,this._invKeySchedule,h,u,d,p,o),i=t[e+1],t[e+1]=t[e+3],t[e+3]=i},_doCryptBlock:function(t,e,i,r,n,o,s,a){for(var l=this._nRounds,c=t[e]^i[0],h=t[e+1]^i[1],u=t[e+2]^i[2],d=t[e+3]^i[3],p=4,f=1;f<l;f++){var y=r[c>>>24]^n[h>>>16&255]^o[u>>>8&255]^s[255&d]^i[p++],v=r[h>>>24]^n[u>>>16&255]^o[d>>>8&255]^s[255&c]^i[p++],g=r[u>>>24]^n[d>>>16&255]^o[c>>>8&255]^s[255&h]^i[p++],m=r[d>>>24]^n[c>>>16&255]^o[h>>>8&255]^s[255&u]^i[p++];c=y,h=v,u=g,d=m}y=(a[c>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&d])^i[p++],v=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[d>>>8&255]<<8|a[255&c])^i[p++],g=(a[u>>>24]<<24|a[d>>>16&255]<<16|a[c>>>8&255]<<8|a[255&h])^i[p++],m=(a[d>>>24]<<24|a[c>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^i[p++],t[e]=y,t[e+1]=v,t[e+2]=g,t[e+3]=m},keySize:8});t.AES=e._createHelper(y)}(),r.AES)},function(t,e,i){var r,n,o,s,a,l,c,h;t.exports=(r=i(0),i(9),i(10),o=(n=r).lib,s=o.Base,a=o.WordArray,l=n.algo,c=l.MD5,h=l.EvpKDF=s.extend({cfg:s.extend({keySize:4,hasher:c,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var i=this.cfg,r=i.hasher.create(),n=a.create(),o=n.words,s=i.keySize,l=i.iterations;o.length<s;){c&&r.update(c);var c=r.update(t).finalize(e);r.reset();for(var h=1;h<l;h++)c=r.finalize(c),r.reset();n.concat(c)}return n.sigBytes=4*s,n}}),n.EvpKDF=function(t,e,i){return h.create(i).compute(t,e)},r.EvpKDF)},function(t,e,i){(function(r,n){var o,s,a;s=[],void 0===(a="function"==typeof(o=function(){return function(){"use strict";var t=Object.prototype.hasOwnProperty,e={copyProperties:function(t,e){var i;for(i in t)e[i]=t[i]},resolveTransformObject:function(t,i,r){var n,o;if("number"!=typeof r&&(r=0),++r>=10)return t;for(n in t)"string"==typeof t[n]&&0===t[n].indexOf("[%lktxp]")?(o=t[n].substring(8),i.hasOwnProperty(o)&&(t[n]=i[o])):"object"==typeof t[n]&&(t[n]=e.resolveTransformObject(t[n],i,r));return t},resolveTransformParams:function(t,i){var r,n,o=[];if(void 0===i)return t;for(r=0;r<t.length;r++)n=y(t[r],"shallow-recurse-objects"),o.push(e.resolveTransformObject(n,i));return o}},o={aeq:s,lt:a,gt:l};function s(t,e){var i,r,n,o;if(t===e)return!0;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:n=1;break;case!1:n=3;break;case!0:n=4;break;case"":n=5;break;default:n=t==t?9:0}switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}if(9!==n||9!==o)return n===o}return i=Number(t),r=Number(e),i==i||r==r?i===r:(i=t.toString(),r=e.toString(),i==r)}function a(t,e,i){var r,n,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?i:o<s}return r=Number(t),n=Number(e),r==r&&n==n?r<n||!(r>n)&&i:r==r&&n!=n||(n!=n||r==r)&&(t<e||!(t>e)&&(t==e?i:(r=t.toString(),n=e.toString(),r<n||r==n&&i)))}function l(t,e,i){var r,n,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?i:o>s}return r=Number(t),n=Number(e),r==r&&n==n?r>n||!(r<n)&&i:(r!=r||n==n)&&(n==n&&r!=r||t>e||!(t<e)&&(t==e?i:(r=t.toString(),n=e.toString(),r>n||r==n&&i)))}function c(t,e,i){return o.aeq(t,e)?0:o.lt(t,e,!1)?i?1:-1:o.gt(t,e,!1)?i?-1:1:0}function h(e,i,r,n,o){var s=o||0,a=i[s];if(null==e||!t.call(e,a))return!1;var l=!1,c=e[a];if(s+1>=i.length)l=r(c,n);else if(Array.isArray(c))for(var u=0,d=c.length;u<d&&!0!==(l=h(c[u],i,r,n,s+1));u+=1);else l=h(c,i,r,n,s+1);return l}function u(e){return"string"==typeof e||Array.isArray(e)?function(t){return-1!==e.indexOf(t)}:"object"==typeof e&&null!==e?function(i){return t.call(e,i)}:null}function d(e,i){for(var r in i)if(t.call(i,r))return p[r](e,i[r]);return!1}var p={$eq:function(t,e){return t===e},$aeq:function(t,e){return t==e},$ne:function(t,e){return e!=e?t==t:t!==e},$dteq:function(t,e){return o.aeq(t,e)},$gt:function(t,e){return o.gt(t,e,!1)},$gte:function(t,e){return o.gt(t,e,!0)},$lt:function(t,e){return o.lt(t,e,!1)},$lte:function(t,e){return o.lt(t,e,!0)},$jgt:function(t,e){return t>e},$jgte:function(t,e){return t>=e},$jlt:function(t,e){return t<e},$jlte:function(t,e){return t<=e},$between:function(t,e){return null!=t&&o.gt(t,e[0],!0)&&o.lt(t,e[1],!0)},$jbetween:function(t,e){return null!=t&&t>=e[0]&&t<=e[1]},$in:function(t,e){return-1!==e.indexOf(t)},$nin:function(t,e){return-1===e.indexOf(t)},$keyin:function(t,e){return t in e},$nkeyin:function(t,e){return!(t in e)},$definedin:function(t,e){return void 0!==e[t]},$undefinedin:function(t,e){return void 0===e[t]},$regex:function(t,e){return e.test(t)},$containsString:function(t,e){return"string"==typeof t&&-1!==t.indexOf(e)},$containsNone:function(t,e){return!p.$containsAny(t,e)},$containsAny:function(t,e){var i=u(t);return null!==i&&(Array.isArray(e)?e.some(i):i(e))},$contains:function(t,e){var i=u(t);return null!==i&&(Array.isArray(e)?e.every(i):i(e))},$type:function(t,e){var i=typeof t;return"object"===i&&(Array.isArray(t)?i="array":t instanceof Date&&(i="date")),"object"!=typeof e?i===e:d(i,e)},$finite:function(t,e){return e===isFinite(t)},$size:function(t,e){return!!Array.isArray(t)&&("object"!=typeof e?t.length===e:d(t.length,e))},$len:function(t,e){return"string"==typeof t&&("object"!=typeof e?t.length===e:d(t.length,e))},$where:function(t,e){return!0===e(t)},$not:function(t,e){return!d(t,e)},$and:function(t,e){for(var i=0,r=e.length;i<r;i+=1)if(!d(t,e[i]))return!1;return!0},$or:function(t,e){for(var i=0,r=e.length;i<r;i+=1)if(d(t,e[i]))return!0;return!1}},f={$eq:p.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};function y(t,e){if(null==t)return null;var i,r=e||"parse-stringify";switch(r){case"parse-stringify":i=JSON.parse(JSON.stringify(t));break;case"jquery-extend-deep":i=jQuery.extend(!0,{},t);break;case"shallow":i=Object.create(t.constructor.prototype),Object.keys(t).map(function(e){i[e]=t[e]});break;case"shallow-assign":i=Object.create(t.constructor.prototype),Object.assign(i,t);break;case"shallow-recurse-objects":i=y(t,"shallow");var n=Object.keys(t);n.forEach(function(e){"object"==typeof t[e]&&"Object"===t[e].constructor.name&&(i[e]=y(t[e],"shallow-recurse-objects"))})}return i}function v(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch(t){return!1}}function g(){}function m(t,e){this.filename=t||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!e||!e.hasOwnProperty("verbose"))&&e.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]},e&&e.hasOwnProperty("env")?this.ENV=e.env:this.ENV=void 0!==r&&(r.android||r.NSObject)?"NATIVESCRIPT":"undefined"==typeof window?"NODEJS":void 0!==r&&r.window&&n?"NODEJS":"undefined"!=typeof document?-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER":"CORDOVA","undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(e,!0),this.on("init",this.clearChanges)}function b(t){this.hashStore={},this.options=t||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function w(t,e){if(this.mode="reference",this.adapter=null,this.options=e||{},this.dbref=null,this.dbname="",this.pageIterator={},!t)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===t.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=t,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function x(){try{this.fs=i(!function(){var t=new Error("Cannot find module 'fs'");throw t.code="MODULE_NOT_FOUND",t}())}catch(t){this.fs=null}}function I(){}function k(t,e){return e=e||{},this.collection=t,this.filteredrows=[],this.filterInitialized=!1,this}function O(t,e,i){this.collection=t,this.name=e,this.rebuildPending=!1,this.options=i||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new k(t),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[]}}function S(e,i){this.name=e,this.data=[],this.idIndex=[],this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var r=this;(i=i||{}).hasOwnProperty("unique")&&(Array.isArray(i.unique)||(i.unique=[i.unique]),i.unique.forEach(function(t){r.uniqueNames.push(t),r.constraints.unique[t]=new B(t)})),i.hasOwnProperty("exact")&&i.exact.forEach(function(t){r.constraints.exact[t]=new j(t)}),this.adaptiveBinaryIndices=!i.hasOwnProperty("adaptiveBinaryIndices")||i.adaptiveBinaryIndices,this.transactional=!!i.hasOwnProperty("transactional")&&i.transactional,this.cloneObjects=!!i.hasOwnProperty("clone")&&i.clone,this.cloneMethod=i.hasOwnProperty("cloneMethod")?i.cloneMethod:"parse-stringify",this.asyncListeners=!!i.hasOwnProperty("asyncListeners")&&i.asyncListeners,this.disableMeta=!!i.hasOwnProperty("disableMeta")&&i.disableMeta,this.disableChangesApi=!i.hasOwnProperty("disableChangesApi")||i.disableChangesApi,this.disableDeltaChangesApi=!i.hasOwnProperty("disableDeltaChangesApi")||i.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!i.hasOwnProperty("autoupdate")&&i.autoupdate,this.serializableIndices=!i.hasOwnProperty("serializableIndices")||i.serializableIndices,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(i.ttl||-1,i.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.ensureId();var n=[];if(i&&i.indices)if("[object Array]"===Object.prototype.toString.call(i.indices))n=i.indices;else{if("string"!=typeof i.indices)throw new TypeError("Indices needs to be a string or an array of strings");n=[i.indices]}for(var o=0;o<n.length;o++)this.ensureIndex(n[o]);function s(t,e){var i=null!==e&&"object"==typeof e?Object.keys(e):null;if(i&&i.length&&["string","boolean","number"].indexOf(typeof e)<0){for(var n={},o=0;o<i.length;o++){var a=i[o];if(e.hasOwnProperty(a))if(!t.hasOwnProperty(a)||r.uniqueNames.indexOf(a)>=0||"$loki"==a||"meta"==a)n[a]=e[a];else{var l=s(t[a],e[a]);void 0!==l&&l!={}&&(n[a]=l)}}return 0===Object.keys(n).length?void 0:n}return t===e?void 0:e}function a(){r.changes=[]}this.observerCallback=function(e){var i="function"==typeof Set?new Set:[];i.add||(i.add=function(t){return-1===this.indexOf(t)&&this.push(t),this}),e.forEach(function(t){i.add(t.object)}),i.forEach(function(e){if(!t.call(e,"$loki"))return r.removeAutoUpdateObserver(e);try{r.update(e)}catch(t){}})},this.getChangeDelta=function(t,e){return e?s(e,t):JSON.parse(JSON.stringify(t))},this.getObjectDelta=s,this.getChanges=function(){return r.changes},this.flushChanges=a,this.setChangesApi=function(t){r.disableChangesApi=!t,t||(r.disableDeltaChangesApi=!1)},this.on("delete",function(t){r.disableChangesApi||r.createChange(r.name,"R",t)}),this.on("warning",function(t){r.console.warn(t)}),a()}function D(t){return-1!==t.indexOf(".")}function C(t){return parseFloat(t,10)}function A(t,e){return t+e}function P(t,e){return t-e}function E(t){return t.reduce(A,0)/t.length}function _(t,e,i){if(!1===i)return t[e];for(var r=e.split("."),n=t;r.length>0;)n=n[r.shift()];return n}function M(t,e,i){for(var r,n,o=0,s=t.length;o<s;){if(n=o+s>>1,0===(r=i.apply(null,[e,t[n]])))return{found:!0,index:n};r<0?s=n:o=n+1}return{found:!1,index:s}}function $(t){return function(e,i){return M(e,i,t)}}function z(){}function B(t){this.field=t,this.keyMap={},this.lokiMap={}}function j(t){this.index={},this.field=t}return g.prototype.events={},g.prototype.asyncListeners=!1,g.prototype.on=function(t,e){var i,r=this;return Array.isArray(t)?(t.forEach(function(t){r.on(t,e)}),e):((i=this.events[t])||(i=this.events[t]=[]),i.push(e),e)},g.prototype.emit=function(t){var e=this,i=Array.prototype.slice.call(arguments,1);if(!t||!this.events[t])throw new Error("No event "+t+" defined");this.events[t].forEach(function(t){e.asyncListeners?setTimeout(function(){t.apply(e,i)},1):t.apply(e,i)})},g.prototype.addListener=g.prototype.on,g.prototype.removeListener=function(t,e){var i=this;if(Array.isArray(t))t.forEach(function(t){i.removeListener(t,e)});else if(this.events[t]){var r=this.events[t];r.splice(r.indexOf(e),1)}},m.prototype=new g,m.prototype.constructor=m,m.prototype.getIndexedAdapter=function(){return i(6)},m.prototype.configureOptions=function(t,e){var i={fs:x,localStorage:I,memory:b};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,void 0!==t){if(this.options=t,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof i[t.persistenceMethod]&&(this.persistenceMethod=t.persistenceMethod,this.persistenceAdapter=new i[t.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=t.adapter,this.options.adapter=null),t.autoload&&e){var r=this;setTimeout(function(){r.loadDatabase(t,t.autoloadCallback)},1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(t,t.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)}this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"}[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new i[this.persistenceMethod]))},m.prototype.copy=function(t){var e,i,r=new m(this.filename,{env:"NA"});if(t=t||{},r.loadJSONObject(this,{retainDirtyFlags:!0}),t.hasOwnProperty("removeNonSerializable")&&!0===t.removeNonSerializable)for(r.autosaveHandle=null,r.persistenceAdapter=null,e=r.collections.length,i=0;i<e;i++)r.collections[i].constraints=null,r.collections[i].ttl=null;return r},m.prototype.addCollection=function(t,e){var i,r=this.collections.length;if(e&&!0===e.disableMeta){if(!1===e.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===e.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof e.ttl&&e.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(i=0;i<r;i+=1)if(this.collections[i].name===t)return this.collections[i];var n=new S(t,e);return this.collections.push(n),this.verbose&&(n.console=console),n},m.prototype.loadCollection=function(t){if(!t.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(t)},m.prototype.getCollection=function(t){var e,i=this.collections.length;for(e=0;e<i;e+=1)if(this.collections[e].name===t)return this.collections[e];return this.emit("warning","collection "+t+" not found"),null},m.prototype.renameCollection=function(t,e){var i=this.getCollection(t);return i&&(i.name=e),i},m.prototype.listCollections=function(){for(var t=this.collections.length,e=[];t--;)e.push({name:this.collections[t].name,type:this.collections[t].objType,count:this.collections[t].data.length});return e},m.prototype.removeCollection=function(t){var e,i=this.collections.length;for(e=0;e<i;e+=1)if(this.collections[e].name===t){var r=new S(t,{}),n=this.collections[e];for(var o in n)n.hasOwnProperty(o)&&r.hasOwnProperty(o)&&(n[o]=r[o]);return void this.collections.splice(e,1)}},m.prototype.getName=function(){return this.name},m.prototype.serializeReplacer=function(t,e){switch(t){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":return null;case"throttledSavePending":case"throttledCallbacks":return;default:return e}},m.prototype.serialize=function(t){switch((t=t||{}).hasOwnProperty("serializationMethod")||(t.serializationMethod=this.options.serializationMethod),t.serializationMethod){case"normal":return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured();default:return JSON.stringify(this,this.serializeReplacer)}},m.prototype.toJson=m.prototype.serialize,m.prototype.serializeDestructured=function(t){var e,i,r,n,o,s=[];if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),!0===t.partitioned&&t.hasOwnProperty("partition")&&t.partition>=0)return this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:t.partition});for((o=new m(this.filename)).loadJSONObject(this),e=0;e<o.collections.length;e++)o.collections[e].data=[];if(!0===t.partitioned&&-1===t.partition)return o.serialize({serializationMethod:"normal"});for(s.push(o.serialize({serializationMethod:"normal"})),o=null,e=0;e<this.collections.length;e++)if(r=this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:e}),!1===t.partitioned&&!1===t.delimited){if(!Array.isArray(r))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(n=r.length,i=0;i<n;i++)s.push(r[i]),r[i]=null;s.push("")}else s.push(r);return t.partitioned?(t.delimited,s):t.delimited?(s.push(""),s.join(t.delimiter)):(s.push(""),s)},m.prototype.serializeCollection=function(t){var e,i,r=[];if((t=t||{}).hasOwnProperty("delimited")||(t.delimited=!0),!t.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(e=this.collections[t.collectionIndex].data.length,r=[],i=0;i<e;i++)r.push(JSON.stringify(this.collections[t.collectionIndex].data[i]));return t.delimited?(r.push(""),r.join(t.delimiter)):r},m.prototype.deserializeDestructured=function(t,e){var i,r,n,o=[],s=0,a=1,l=!1;if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.partitioned){if(e.hasOwnProperty("partition"))return-1===e.partition?i=JSON.parse(t[0]):this.deserializeCollection(t[e.partition+1],e);for(i=JSON.parse(t[0]),r=i.collections.length,s=0;s<r;s++)i.collections[s].data=this.deserializeCollection(t[s+1],e);return i}if(e.delimited){if(o=t.split(e.delimiter),t=null,0===o.length)return null}else o=t;for(i=JSON.parse(o[0]),r=i.collections.length,o[0]=null;!l;)o[a],""===o[a]?++s>r&&(l=!0):(n=JSON.parse(o[a]),i.collections[s].data.push(n)),o[a++]=null;return i},m.prototype.deserializeCollection=function(t,e){var i,r,n=[];for((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.delimited?(n=t.split(e.delimiter)).pop():n=t,r=n.length,i=0;i<r;i++)n[i]=JSON.parse(n[i]);return n},m.prototype.loadJSON=function(t,e){var i;if(0===t.length)i={};else switch(this.options.serializationMethod){case"normal":case"pretty":i=JSON.parse(t);break;case"destructured":i=this.deserializeDestructured(t);break;default:i=JSON.parse(t)}this.loadJSONObject(i,e)},m.prototype.loadJSONObject=function(t,i){var r,n,o,s,a,l,c=0,h=t.collections?t.collections.length:0;function u(t){var r,n=i[t.name];return n.proto?(r=n.inflate||e.copyProperties,function(t){var e=new n.proto;return r(t,e),e}):n.inflate}for(this.name=t.name,t.hasOwnProperty("throttledSaves")&&i&&!i.hasOwnProperty("throttledSaves")&&(this.throttledSaves=t.throttledSaves),this.collections=[];c<h;c+=1){if(r=t.collections[c],(n=this.addCollection(r.name,{disableChangesApi:r.disableChangesApi,disableDeltaChangesApi:r.disableDeltaChangesApi,disableMeta:r.disableMeta})).adaptiveBinaryIndices=!!r.hasOwnProperty("adaptiveBinaryIndices")&&!0===r.adaptiveBinaryIndices,n.transactional=r.transactional,n.asyncListeners=r.asyncListeners,n.cloneObjects=r.cloneObjects,n.cloneMethod=r.cloneMethod||"parse-stringify",n.autoupdate=r.autoupdate,n.changes=r.changes,i&&!0===i.retainDirtyFlags?n.dirty=r.dirty:n.dirty=!1,o=r.data.length,s=0,i&&i.hasOwnProperty(r.name))for(a=u(r);s<o;s++)l=a(r.data[s]),n.data[s]=l,n.addAutoUpdateObserver(l);else for(;s<o;s++)n.data[s]=r.data[s],n.addAutoUpdateObserver(n.data[s]);if(n.maxId=void 0===r.maxId?0:r.maxId,n.idIndex=r.idIndex,void 0!==r.binaryIndices&&(n.binaryIndices=r.binaryIndices),void 0!==r.transforms&&(n.transforms=r.transforms),n.ensureId(),n.uniqueNames=[],r.hasOwnProperty("uniqueNames"))for(n.uniqueNames=r.uniqueNames,s=0;s<n.uniqueNames.length;s++)n.ensureUniqueIndex(n.uniqueNames[s]);if(void 0!==r.DynamicViews){for(var d=0;d<r.DynamicViews.length;d++){var p=r.DynamicViews[d],f=n.addDynamicView(p.name,p.options);f.resultdata=p.resultdata,f.resultsdirty=p.resultsdirty,f.filterPipeline=p.filterPipeline,f.sortCriteria=p.sortCriteria,f.sortFunction=null,f.sortDirty=p.sortDirty,f.resultset.filteredrows=p.resultset.filteredrows,f.resultset.filterInitialized=p.resultset.filterInitialized,f.rematerialize({removeWhereFilters:!0})}t.databaseVersion<1.5&&(n.ensureAllIndexes(!0),n.dirty=!0)}}},m.prototype.close=function(t){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(t),t=void 0)),t&&this.on("close",t),this.emit("close")},m.prototype.generateChangesNotification=function(t){function e(t){return t.name}var i=[],r=t||this.collections.map(e);return this.collections.forEach(function(t){-1!==r.indexOf(e(t))&&(i=i.concat(t.getChanges()))}),i},m.prototype.serializeChanges=function(t){return JSON.stringify(this.generateChangesNotification(t))},m.prototype.clearChanges=function(){this.collections.forEach(function(t){t.flushChanges&&t.flushChanges()})},b.prototype.loadDatabase=function(t,e){var i=this;this.options.asyncResponses?setTimeout(function(){i.hashStore.hasOwnProperty(t)?e(i.hashStore[t].value):e(null)},this.options.asyncTimeout):this.hashStore.hasOwnProperty(t)?e(this.hashStore[t].value):e(null)},b.prototype.saveDatabase=function(t,e,i){var r,n=this;this.options.asyncResponses?setTimeout(function(){r=n.hashStore.hasOwnProperty(t)?n.hashStore[t].savecount:0,n.hashStore[t]={savecount:r+1,lastsave:new Date,value:e},i()},this.options.asyncTimeout):(r=this.hashStore.hasOwnProperty(t)?this.hashStore[t].savecount:0,this.hashStore[t]={savecount:r+1,lastsave:new Date,value:e},i())},b.prototype.deleteDatabase=function(t,e){this.hashStore.hasOwnProperty(t)&&delete this.hashStore[t],"function"==typeof e&&e()},w.prototype.loadDatabase=function(t,e){var i=this;this.dbname=t,this.dbref=new m(t),this.adapter.loadDatabase(t,function(t){if(t){"string"!=typeof t&&e(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()"));var r=JSON.parse(t);i.dbref.loadJSONObject(r),r=null,i.dbref.collections.length,0!==i.dbref.collections.length?(i.pageIterator={collection:0,pageIndex:0},i.loadNextPartition(0,function(){e(i.dbref)})):e(i.dbref)}else e(t)})},w.prototype.loadNextPartition=function(t,e){var i=this.dbname+"."+t,r=this;if(!0===this.options.paging)return this.pageIterator.pageIndex=0,void this.loadNextPage(e);this.adapter.loadDatabase(i,function(i){var n=r.dbref.deserializeCollection(i,{delimited:!0,collectionIndex:t});r.dbref.collections[t].data=n,++t<r.dbref.collections.length?r.loadNextPartition(t,e):e()})},w.prototype.loadNextPage=function(t){var e=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,i=this;this.adapter.loadDatabase(e,function(e){var r=e.split(i.options.delimiter);e="";var n,o=r.length,s=""===r[o-1];for(s&&(r.pop(),o=r.length,""===r[o-1]&&1===o&&(r.pop(),o=r.length)),n=0;n<o;n++)i.dbref.collections[i.pageIterator.collection].data.push(JSON.parse(r[n])),r[n]=null;r=[],s?++i.pageIterator.collection<i.dbref.collections.length?i.loadNextPartition(i.pageIterator.collection,t):t():(i.pageIterator.pageIndex++,i.loadNextPage(t))})},w.prototype.exportDatabase=function(t,e,i){var r,n=e.collections.length;for(this.dbref=e,this.dbname=t,this.dirtyPartitions=[-1],r=0;r<n;r++)e.collections[r].dirty&&this.dirtyPartitions.push(r);this.saveNextPartition(function(t){i(t)})},w.prototype.saveNextPartition=function(t){var e=this,i=this.dirtyPartitions.shift(),r=this.dbname+(-1===i?"":"."+i);if(this.options.paging&&-1!==i)return this.pageIterator={collection:i,docIndex:0,pageIndex:0},void this.saveNextPage(function(i){0===e.dirtyPartitions.length?t(i):e.saveNextPartition(t)});var n=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:i});this.adapter.saveDatabase(r,n,function(i){i?t(i):0===e.dirtyPartitions.length?t(null):e.saveNextPartition(t)})},w.prototype.saveNextPage=function(t){var e=this,i=this.dbref.collections[this.pageIterator.collection],r=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,n=0,o=i.data.length,s=this.options.delimiter.length,a="",l="",c=!1,h=!1,u=function(i){l="",i&&t(i),c?t(null):(e.pageIterator.pageIndex++,e.saveNextPage(t))};for(0===i.data.length&&(c=!0);;)if(c||(a=JSON.stringify(i.data[this.pageIterator.docIndex]),l+=a,n+=a.length,++this.pageIterator.docIndex>=o&&(c=!0)),n>=this.options.pageSize&&(h=!0),h&&!c||(l+=this.options.delimiter,n+=s),c||h)return void this.adapter.saveDatabase(r,l,u)},x.prototype.loadDatabase=function(t,e){var i=this;this.fs.stat(t,function(r,n){!r&&n.isFile()?i.fs.readFile(t,{encoding:"utf8"},function(t,i){e(t?new Error(t):i)}):e(null)})},x.prototype.saveDatabase=function(t,e,i){var r=this,n=t+"~";this.fs.writeFile(n,e,function(e){e?i(new Error(e)):r.fs.rename(n,t,i)})},x.prototype.deleteDatabase=function(t,e){this.fs.unlink(t,function(t){t?e(new Error(t)):e()})},I.prototype.loadDatabase=function(t,e){v()?e(localStorage.getItem(t)):e(new Error("localStorage is not available"))},I.prototype.saveDatabase=function(t,e,i){v()?(localStorage.setItem(t,e),i(null)):i(new Error("localStorage is not available"))},I.prototype.deleteDatabase=function(t,e){v()?(localStorage.removeItem(t),e(null)):e(new Error("localStorage is not available"))},m.prototype.throttledSaveDrain=function(t,e){var i=this,r=(new Date).getTime();if(this.throttledSaves||t(!0),(e=e||{}).hasOwnProperty("recursiveWait")||(e.recursiveWait=!0),e.hasOwnProperty("recursiveWaitLimit")||(e.recursiveWaitLimit=!1),e.hasOwnProperty("recursiveWaitLimitDuration")||(e.recursiveWaitLimitDuration=2e3),e.hasOwnProperty("started")||(e.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending){if(!e.recursiveWait)return void this.throttledCallbacks.push(t);this.throttledCallbacks.push(function(){return i.throttledSavePending?e.recursiveWaitLimit&&r-e.started>e.recursiveWaitLimitDuration?void t(!1):void i.throttledSaveDrain(t,e):void t(!0)})}else t(!0)},m.prototype.loadDatabaseInternal=function(t,e){var i=e||function(t,e){if(t)throw t},r=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,function(e){if("string"==typeof e){var n=!1;try{r.loadJSON(e,t||{}),n=!0}catch(t){i(t)}n&&(i(null),r.emit("loaded","database "+r.filename+" loaded"))}else{if(!e)return i(null),void r.emit("loaded","empty database "+r.filename+" loaded");if(e instanceof Error)return void i(e);if("object"==typeof e)return r.loadJSONObject(e,t||{}),i(null),void r.emit("loaded","database "+r.filename+" loaded");i("unexpected adapter response : "+e)}}):i(new Error("persistenceAdapter not configured"))},m.prototype.loadDatabase=function(t,e){var i=this;this.throttledSaves?this.throttledSaveDrain(function(r){if(r)return i.throttledSavePending=!0,void i.loadDatabaseInternal(t,function(t){0===i.throttledCallbacks.length?i.throttledSavePending=!1:i.saveDatabase(),"function"==typeof e&&e(t)});"function"==typeof e&&e(new Error("Unable to pause save throttling long enough to read database"))},t):this.loadDatabaseInternal(t,e)},m.prototype.saveDatabaseInternal=function(t){var e=t||function(t){if(t)throw t},i=this;null!==this.persistenceAdapter?"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),function(t){i.autosaveClearFlags(),e(t)}):(i.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,i.serialize(),function(t){e(t)})):e(new Error("persistenceAdapter not configured"))},m.prototype.saveDatabase=function(t){if(this.throttledSaves)if(this.throttledSavePending)this.throttledCallbacks.push(t);else{var e=this.throttledCallbacks;this.throttledCallbacks=[],e.unshift(t),this.throttledSavePending=!0;var i=this;this.saveDatabaseInternal(function(t){i.throttledSavePending=!1,e.forEach(function(e){"function"==typeof e&&setTimeout(function(){e(t)},1)}),i.throttledCallbacks.length>0&&i.saveDatabase()})}else this.saveDatabaseInternal(t)},m.prototype.save=m.prototype.saveDatabase,m.prototype.deleteDatabase=function(t,e){var i=e||function(t,e){if(t)throw t};"function"!=typeof t||e||(i=t),null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,function(t){i(t)}):i(new Error("persistenceAdapter not configured"))},m.prototype.autosaveDirty=function(){for(var t=0;t<this.collections.length;t++)if(this.collections[t].dirty)return!0;return!1},m.prototype.autosaveClearFlags=function(){for(var t=0;t<this.collections.length;t++)this.collections[t].dirty=!1},m.prototype.autosaveEnable=function(t,e){this.autosave=!0;var i=5e3,r=this;void 0!==this.autosaveInterval&&null!==this.autosaveInterval&&(i=this.autosaveInterval),this.autosaveHandle=setInterval(function(){r.autosaveDirty()&&r.saveDatabase(e)},i)},m.prototype.autosaveDisable=function(){void 0!==this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},k.prototype.reset=function(){return this.filteredrows.length>0&&(this.filteredrows=[]),this.filterInitialized=!1,this},k.prototype.toJSON=function(){var t=this.copy();return t.collection=null,t},k.prototype.limit=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new k(this.collection);return e.filteredrows=this.filteredrows.slice(0,t),e.filterInitialized=!0,e},k.prototype.offset=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new k(this.collection);return e.filteredrows=this.filteredrows.slice(t),e.filterInitialized=!0,e},k.prototype.copy=function(){var t=new k(this.collection);return this.filteredrows.length>0&&(t.filteredrows=this.filteredrows.slice()),t.filterInitialized=this.filterInitialized,t},k.prototype.branch=k.prototype.copy,k.prototype.transform=function(t,i){var r,n,o=this;if("string"==typeof t&&this.collection.transforms.hasOwnProperty(t)&&(t=this.collection.transforms[t]),"object"!=typeof t||!Array.isArray(t))throw new Error("Invalid transform");for(void 0!==i&&(t=e.resolveTransformParams(t,i)),r=0;r<t.length;r++)switch((n=t[r]).type){case"find":o.find(n.value);break;case"where":o.where(n.value);break;case"simplesort":o.simplesort(n.property,n.desc||n.options);break;case"compoundsort":o.compoundsort(n.value);break;case"sort":o.sort(n.value);break;case"limit":o=o.limit(n.value);break;case"offset":o=o.offset(n.value);break;case"map":o=o.map(n.value,n.dataOptions);break;case"eqJoin":o=o.eqJoin(n.joinData,n.leftJoinKey,n.rightJoinKey,n.mapFun,n.dataOptions);break;case"mapReduce":o=o.mapReduce(n.mapFunction,n.reduceFunction);break;case"update":o.update(n.value);break;case"remove":o.remove()}return o},k.prototype.sort=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e,i,r=(e=t,i=this.collection.data,function(t,r){return e(i[t],i[r])});return this.filteredrows.sort(r),this},k.prototype.simplesort=function(t,e){var i,r=10,n=this.collection.data.length,o=this.filteredrows.length,s=this.collection.binaryIndices.hasOwnProperty(t);if(void 0!==e&&!1!==e||(e={desc:!1}),!0===e&&(e={desc:!0}),0===o){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(t))return this.collection.ensureIndex(t),this.filteredrows=this.collection.binaryIndices[t].values.slice(0),e.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!e.disableIndexIntersect&&s&&(i=n/o,e.useJavascriptSorting&&(r=6),i<=r||e.forceIndexIntersect)){var a,l=this.filteredrows,h={};for(a=0;a<o;a++)h[l[a]]=!0;var u=this.collection.binaryIndices[t].values;return this.filteredrows=u.filter(function(t){return h[t]}),e.desc&&this.filteredrows.reverse(),this}if(e.useJavascriptSorting)return this.sort(function(e,i){return e[t]===i[t]?0:e[t]>i[t]?1:e[t]<i[t]?-1:void 0});var d,p,f,y,v,g,m=(d=t,p=e.desc,f=this.collection.data,function(t,e){return~d.indexOf(".")?(g=d.split("."),y=g.reduce(function(t,e){return t&&t[e]||void 0},f[t]),v=g.reduce(function(t,e){return t&&t[e]||void 0},f[e])):(y=f[t][d],v=f[e][d]),c(y,v,p)});return this.filteredrows.sort(m),this},k.prototype.compoundsort=function(t){if(0===t.length)throw new Error("Invalid call to compoundsort, need at least one property");var e;if(1===t.length)return e=t[0],Array.isArray(e)?this.simplesort(e[0],e[1]):this.simplesort(e,!1);for(var i=0,r=t.length;i<r;i+=1)e=t[i],Array.isArray(e)||(t[i]=[e,!1]);this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var n,o,s=(n=t,o=this.collection.data,function(t,e){return function(t,e,i){for(var r,n,o,s,a,l=0,h=0,u=t.length;h<u;h++)if(r=t[h],~(n=r[0]).indexOf(".")?(a=n.split("."),o=a.reduce(function(t,e){return t&&t[e]||void 0},e),s=a.reduce(function(t,e){return t&&t[e]||void 0},i)):(o=e[n],s=i[n]),0!==(l=c(o,s,r[1])))return l;return 0}(n,o[t],o[e])});return this.filteredrows.sort(s),this},k.prototype.findOr=function(t){for(var e=null,i=0,r=0,n=[],o=[],s=0,a=this.count(),l=0,c=t.length;l<c;l++){if(e=this.branch().find(t[l]).filteredrows,(r=e.length)===a)return this;for(i=0;i<r;i++)s=e[i],void 0===o[s]&&(o[s]=!0,n.push(s))}return this.filteredrows=n,this.filterInitialized=!0,this},k.prototype.$or=k.prototype.findOr,k.prototype.findAnd=function(t){for(var e=0,i=t.length;e<i;e++){if(0===this.count())return this;this.find(t[e])}return this},k.prototype.$and=k.prototype.findAnd,k.prototype.find=function(e,i){if(0===this.collection.data.length)return this.filteredrows=[],this.filterInitialized=!0,this;var r,n,o,s,a,l,c,u=e||"getAll",d=!1,y=[],v=[],g=null;if(i=i||!1,"object"==typeof u){for(r in u)(s={})[r]=u[r],v.push(s),t.call(u,r)&&(n=r,o=u[r]);if(v.length>1)return this.find({$and:v},i)}if(!n||"getAll"===u)return i&&(this.filteredrows=this.collection.data.length>0?[0]:[],this.filterInitialized=!0),this;if("$and"===n||"$or"===n)return this[n](o),i&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(null===o||"object"!=typeof o||o instanceof Date)a="$eq",l=o;else{if("object"!=typeof o)throw new Error("Do not know what you want to do.");for(c in o)if(t.call(o,c)){a=c,l=o[c];break}}"$regex"===a&&(Array.isArray(l)?l=new RegExp(l[0],l[1]):l instanceof RegExp||(l=new RegExp(l)));var m=-1!==n.indexOf("."),b=!m&&!this.filterInitialized;b&&this.collection.binaryIndices[n]&&f[a]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(n),d=!0,g=this.collection.binaryIndices[n]);var w,x=p[a],I=this.collection.data,k=0,O=0,S=0;if(this.filterInitialized)if(w=this.filteredrows,O=w.length,m)for(n=n.split("."),k=0;k<O;k++)S=w[k],h(I[S],n,x,l)&&y.push(S);else for(k=0;k<O;k++)S=w[k],x(I[S][n],l)&&y.push(S);else if(d){var D=this.collection.calculateRange(a,n,l);if("$in"!==a){for(k=D[0];k<=D[1];k++)if(!0!==f[a]){if(f[a](I[g.values[k]][n],l)&&(y.push(g.values[k]),i))return this.filteredrows=y,this.filterInitialized=!0,this}else if(y.push(g.values[k]),i)return this.filteredrows=y,this.filterInitialized=!0,this}else for(k=0,O=D.length;k<O;k++)if(y.push(g.values[D[k]]),i)return this.filteredrows=y,this.filterInitialized=!0,this}else if(O=I.length,m){for(n=n.split("."),k=0;k<O;k++)if(h(I[k],n,x,l)&&(y.push(k),i))return this.filteredrows=y,this.filterInitialized=!0,this}else for(k=0;k<O;k++)if(x(I[k][n],l)&&(y.push(k),i))return this.filteredrows=y,this.filterInitialized=!0,this;return this.filteredrows=y,this.filterInitialized=!0,this},k.prototype.where=function(t){var e,i=[];if("function"!=typeof t)throw new TypeError("Argument is not a stored view or a function");e=t;try{if(this.filterInitialized){for(var r=this.filteredrows.length;r--;)!0===e(this.collection.data[this.filteredrows[r]])&&i.push(this.filteredrows[r]);return this.filteredrows=i,this}for(var n=this.collection.data.length;n--;)!0===e(this.collection.data[n])&&i.push(n);return this.filteredrows=i,this.filterInitialized=!0,this}catch(t){throw t}},k.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},k.prototype.data=function(t){var e,i,r,n,o=[],s=this.collection.data;if((t=t||{}).removeMeta&&!t.forceClones&&(t.forceClones=!0,t.forceCloneMethod=t.forceCloneMethod||"shallow"),this.collection.disableDeltaChangesApi||(t.forceClones=!0,t.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||t.forceClones){for(i=s.length,n=t.forceCloneMethod||this.collection.cloneMethod,r=0;r<i;r++)e=y(s[r],n),t.removeMeta&&(delete e.$loki,delete e.meta),o.push(e);return o}return s.slice()}this.filterInitialized=!0}var a=this.filteredrows;if(i=a.length,this.collection.cloneObjects||t.forceClones)for(n=t.forceCloneMethod||this.collection.cloneMethod,r=0;r<i;r++)e=y(s[a[r]],n),t.removeMeta&&(delete e.$loki,delete e.meta),o.push(e);else for(r=0;r<i;r++)o.push(s[a[r]]);return o},k.prototype.update=function(t){if("function"!=typeof t)throw new TypeError("Argument is not a function");this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());for(var e,i=this.filteredrows.length,r=this.collection.data,n=0;n<i;n++)this.collection.cloneObjects||!this.collection.disableDeltaChangesApi?(e=y(r[this.filteredrows[n]],this.collection.cloneMethod),t(e),this.collection.update(e)):(t(r[this.filteredrows[n]]),this.collection.update(r[this.filteredrows[n]]));return this},k.prototype.remove=function(){return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},k.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},k.prototype.eqJoin=function(t,e,i,r,n){var o,s,a,l=[],c=[],h=[],u="function"==typeof e,d="function"==typeof i,p={};if(l=this.data(n),o=l.length,t instanceof S)c=t.chain().data(n);else if(t instanceof k)c=t.data(n);else{if(!Array.isArray(t))throw new TypeError("joinData needs to be an array or result set");c=t}s=c.length;for(var f=0;f<s;f++)a=d?i(c[f]):c[f][i],p[a]=c[f];r||(r=function(t,e){return{left:t,right:e}});for(var y=0;y<o;y++)a=u?e(l[y]):l[y][e],h.push(r(l[y],p[a]||{}));return this.collection=new S("joinData"),this.collection.insert(h),this.filteredrows=[],this.filterInitialized=!1,this},k.prototype.map=function(t,e){var i=this.data(e).map(t);return this.collection=new S("mappedData"),this.collection.insert(i),this.filteredrows=[],this.filterInitialized=!1,this},O.prototype=new g,O.prototype.rematerialize=function(t){var e,i,r;if(t=t||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new k(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0),t.hasOwnProperty("removeWhereFilters"))for(e=this.filterPipeline.length,i=e;i--;)"where"===this.filterPipeline[i].type&&(i!==this.filterPipeline.length-1&&(this.filterPipeline[i]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var n=this.filterPipeline;for(this.filterPipeline=[],e=n.length,r=0;r<e;r++)this.applyFind(n[r].val);return this.data(),this.emit("rebuild",this),this},O.prototype.branchResultset=function(t,e){var i=this.resultset.branch();return void 0===t?i:i.transform(t,e)},O.prototype.toJSON=function(){var t=new O(this.collection,this.name,this.options);return t.resultset=this.resultset,t.resultdata=[],t.resultsdirty=!0,t.filterPipeline=this.filterPipeline,t.sortFunction=this.sortFunction,t.sortCriteria=this.sortCriteria,t.sortCriteriaSimple=this.sortCriteriaSimple||null,t.sortDirty=this.sortDirty,t.collection=null,t},O.prototype.removeFilters=function(t){t=t||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null,this.filterPipeline=[],this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,!0===t.queueSortPhase&&this.queueSortPhase()},O.prototype.applySort=function(t){return this.sortFunction=t,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this},O.prototype.applySimpleSort=function(t,e){return this.sortCriteriaSimple={propname:t,options:e||!1},this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this},O.prototype.applySortCriteria=function(t){return this.sortCriteria=t,this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this},O.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},O.prototype.commit=function(){return this.cachedresultset=null,this},O.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},O.prototype._indexOfFilterWithId=function(t){if("string"==typeof t||"number"==typeof t)for(var e=0,i=this.filterPipeline.length;e<i;e+=1)if(t===this.filterPipeline[e].uid)return e;return-1},O.prototype._addFilter=function(t){this.filterPipeline.push(t),this.resultset[t.type](t.val)},O.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var t=this.filterPipeline;this.filterPipeline=[];for(var e=0,i=t.length;e<i;e+=1)this._addFilter(t[e]);return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this},O.prototype.applyFilter=function(t){var e=this._indexOfFilterWithId(t.uid);return e>=0?(this.filterPipeline[e]=t,this.reapplyFilters()):(this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(t),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this)},O.prototype.applyFind=function(t,e){return this.applyFilter({type:"find",val:t,uid:e}),this},O.prototype.applyWhere=function(t,e){return this.applyFilter({type:"where",val:t,uid:e}),this},O.prototype.removeFilter=function(t){var e=this._indexOfFilterWithId(t);if(e<0)throw new Error("Dynamic view does not contain a filter with ID: "+t);return this.filterPipeline.splice(e,1),this.reapplyFilters(),this},O.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},O.prototype.data=function(t){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(t)},O.prototype.queueRebuildEvent=function(){if(!this.rebuildPending){this.rebuildPending=!0;var t=this;setTimeout(function(){t.rebuildPending&&(t.rebuildPending=!1,t.emit("rebuild",t))},this.options.minRebuildInterval)}},O.prototype.queueSortPhase=function(){if(!this.sortDirty){this.sortDirty=!0;var t=this;"active"===this.options.sortPriority?setTimeout(function(){t.performSortPhase()},this.options.minRebuildInterval):this.queueRebuildEvent()}},O.prototype.performSortPhase=function(t){(this.sortDirty||this.resultsdirty)&&(t=t||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),t.suppressRebuildEvent||this.emit("rebuild",this))},O.prototype.evaluateDocument=function(t,e){if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var i,r=this.resultset.filteredrows,n=e?-1:r.indexOf(+t),o=r.length,s=new k(this.collection);s.filteredrows=[t],s.filterInitialized=!0;for(var a=0,l=this.filterPipeline.length;a<l;a++)i=this.filterPipeline[a],s[i.type](i.val);var c=0===s.filteredrows.length?-1:0;return-1!==n||-1!==c?-1===n&&-1!==c?(r.push(t),this.options.persistent&&this.resultdata.push(this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==n&&-1===c?(n<o-1?(r.splice(n,1),this.options.persistent&&this.resultdata.splice(n,1)):(r.length=o-1,this.options.persistent&&(this.resultdata.length=o-1)),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==n&&-1!==c?(this.options.persistent&&(this.resultdata[n]=this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},O.prototype.removeDocument=function(t){var e,i,r,n={},o={},s=[],a=this.resultset,l=this.resultset.filteredrows,c=l.length;if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(Array.isArray(t)||(t=[t]),r=t.length,i=0;i<r;i++)n[t[i]]=!0;for(e=0;e<c;e++)n[l[e]]&&(o[e]=!0);Object.keys(o).length>0&&(this.resultset.filteredrows=this.resultset.filteredrows.filter(function(t,e){return!o[e]}),this.options.persistent&&(this.resultdata=this.resultdata.filter(function(t,e){return!o[e]})),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var h=function(t){return function(e){return e<a.filteredrows[t]}};for(c=a.filteredrows.length,e=0;e<c;e++)s=t.filter(h(e)),a.filteredrows[e]-=s.length},O.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},S.prototype=new g,S.prototype.createChange=function(t,e,i,r){this.changes.push({name:t,operation:e,obj:"U"!=e||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(i)):this.getChangeDelta(i,r)})},S.prototype.insertMeta=function(t){var e,i;if(!this.disableMeta&&t)if(Array.isArray(t))for(e=t.length,i=0;i<e;i++)t[i].hasOwnProperty("meta")||(t[i].meta={}),t[i].meta.created=(new Date).getTime(),t[i].meta.revision=0;else t.meta||(t.meta={}),t.meta.created=(new Date).getTime(),t.meta.revision=0},S.prototype.updateMeta=function(t){!this.disableMeta&&t&&(t.meta.updated=(new Date).getTime(),t.meta.revision+=1)},S.prototype.createInsertChange=function(t){this.createChange(this.name,"I",t)},S.prototype.createUpdateChange=function(t,e){this.createChange(this.name,"U",t,e)},S.prototype.insertMetaWithChange=function(t){this.insertMeta(t),this.createInsertChange(t)},S.prototype.updateMetaWithChange=function(t,e){this.updateMeta(t),this.createUpdateChange(t,e)},S.prototype.console={log:function(){},warn:function(){},error:function(){}},S.prototype.addAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.observe(t,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},S.prototype.removeAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.unobserve(t,this.observerCallback)},S.prototype.addTransform=function(t,e){if(this.transforms.hasOwnProperty(t))throw new Error("a transform by that name already exists");this.transforms[t]=e},S.prototype.getTransform=function(t){return this.transforms[t]},S.prototype.setTransform=function(t,e){this.transforms[t]=e},S.prototype.removeTransform=function(t){delete this.transforms[t]},S.prototype.byExample=function(t){var e,i,r;for(e in r=[],t)t.hasOwnProperty(e)&&r.push(((i={})[e]=t[e],i));return{$and:r}},S.prototype.findObject=function(t){return this.findOne(this.byExample(t))},S.prototype.findObjects=function(t){return this.find(this.byExample(t))},S.prototype.ttlDaemonFuncGen=function(){var t=this,e=this.ttl.age;return function(){var i=Date.now(),r=t.chain().where(function(t){var r=t.meta.updated||t.meta.created,n=i-r;return e<n});r.remove()}},S.prototype.setTTL=function(t,e){t<0?clearInterval(this.ttl.daemon):(this.ttl.age=t,this.ttl.ttlInterval=e,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),e))},S.prototype.prepareFullDocIndex=function(){for(var t=this.data.length,e=new Array(t),i=0;i<t;i+=1)e[i]=i;return e},S.prototype.configureOptions=function(t){(t=t||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=t.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},S.prototype.ensureIndex=function(t,e){if(void 0===e&&(e=!1),null==t)throw new Error("Attempting to set index without an associated property");if((!this.binaryIndices[t]||e||this.binaryIndices[t].dirty)&&(!0!==this.adaptiveBinaryIndices||!this.binaryIndices.hasOwnProperty(t)||e)){var i={name:t,dirty:!0,values:this.prepareFullDocIndex()};this.binaryIndices[t]=i;var r,n,s,a,l,c=(r=t,n=this.data,function(t,e){if(~r.indexOf(".")?(l=r.split("."),s=l.reduce(function(t,e){return t&&t[e]||void 0},n[t]),a=l.reduce(function(t,e){return t&&t[e]||void 0},n[e])):(s=n[t][r],a=n[e][r]),s!==a){if(o.lt(s,a,!1))return-1;if(o.gt(s,a,!1))return 1}return 0});i.values.sort(c),i.dirty=!1,this.dirty=!0}},S.prototype.checkAllIndexes=function(e){var i,r=this.binaryIndices,n=[];for(i in r)t.call(r,i)&&(this.checkIndex(i,e)||n.push(i));return n},S.prototype.checkIndex=function(t,e){(e=e||{}).randomSamplingFactor&&!1!==e.randomSampling&&(e.randomSampling=!0),e.randomSamplingFactor=e.randomSamplingFactor||.1,(e.randomSamplingFactor<0||e.randomSamplingFactor>1)&&(e.randomSamplingFactor=.1);var i,r,n,o,s,a=!0;if(!this.binaryIndices.hasOwnProperty(t))throw new Error("called checkIndex on property without an index: "+t);if(this.adaptiveBinaryIndices||this.ensureIndex(t),s=this.binaryIndices[t].values,(o=s.length)!==this.data.length)return e.repair&&this.ensureIndex(t,!0),!1;if(0===o)return!0;if(1===o)a=0===s[0];else if(e.randomSampling){if(p.$lte(this.data[s[0]][t],this.data[s[1]][t])||(a=!1),p.$lte(this.data[s[o-2]][t],this.data[s[o-1]][t])||(a=!1),a)for(r=Math.floor((o-1)*e.randomSamplingFactor),i=0;i<r-1;i++)if(n=Math.floor(Math.random()*(o-1)),!p.$lte(this.data[s[n]][t],this.data[s[n+1]][t])){a=!1;break}}else for(i=0;i<o-1;i++)if(!p.$lte(this.data[s[i]][t],this.data[s[i+1]][t])){a=!1;break}return!a&&e.repair&&this.ensureIndex(t,!0),a},S.prototype.getBinaryIndexValues=function(t){var e,i=this.binaryIndices[t].values,r=[];for(e=0;e<i.length;e++)r.push(this.data[i[e]][t]);return r},S.prototype.ensureUniqueIndex=function(t){var e=this.constraints.unique[t];return e||-1==this.uniqueNames.indexOf(t)&&this.uniqueNames.push(t),this.constraints.unique[t]=e=new B(t),this.data.forEach(function(t){e.set(t)}),e},S.prototype.ensureAllIndexes=function(e){var i,r=this.binaryIndices;for(i in r)t.call(r,i)&&this.ensureIndex(i,e)},S.prototype.flagBinaryIndexesDirty=function(){var e,i=this.binaryIndices;for(e in i)t.call(i,e)&&(i[e].dirty=!0)},S.prototype.flagBinaryIndexDirty=function(t){this.binaryIndices[t]&&(this.binaryIndices[t].dirty=!0)},S.prototype.count=function(t){return t?this.chain().find(t).filteredrows.length:this.data.length},S.prototype.ensureId=function(){var t=this.data.length,e=0;for(this.idIndex=[];e<t;e+=1)this.idIndex.push(this.data[e].$loki)},S.prototype.ensureIdAsync=function(t){this.async(function(){this.ensureId()},t)},S.prototype.addDynamicView=function(t,e){var i=new O(this,t,e);return this.DynamicViews.push(i),i},S.prototype.removeDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].name===t&&this.DynamicViews.splice(e,1)},S.prototype.getDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)if(this.DynamicViews[e].name===t)return this.DynamicViews[e];return null},S.prototype.findAndUpdate=function(t,e){"function"==typeof t?this.updateWhere(t,e):this.chain().find(t).update(e)},S.prototype.findAndRemove=function(t){this.chain().find(t).remove()},S.prototype.insert=function(t){if(!Array.isArray(t))return this.insertOne(t);var e,i=[];this.emit("pre-insert",t);for(var r=0,n=t.length;r<n;r++){if(!(e=this.insertOne(t[r],!0)))return;i.push(e)}return this.emit("insert",i),1===(i=this.cloneObjects?y(i,this.cloneMethod):i).length?i[0]:i},S.prototype.insertOne=function(t,e){var i,r=null;if("object"!=typeof t?r=new TypeError("Document needs to be an object"):null===t&&(r=new TypeError("Object cannot be null")),null!==r)throw this.emit("error",r),r;var n=this.cloneObjects?y(t,this.cloneMethod):t;if(this.disableMeta||void 0!==n.meta||(n.meta={revision:0,created:0}),e||this.emit("pre-insert",n),this.add(n))return this.disableChangesApi?this.insertMeta(n):this.insertMetaWithChange(n),i=this.cloneObjects?y(n,this.cloneMethod):n,e||this.emit("insert",i),this.addAutoUpdateObserver(i),i},S.prototype.clear=function(t){var e=this;if(t=t||{},this.data=[],this.idIndex=[],this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,!0===t.removeIndices)this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[];else{var i=Object.keys(this.binaryIndices);i.forEach(function(t){e.binaryIndices[t].dirty=!1,e.binaryIndices[t].values=[]}),this.constraints={unique:{},exact:{}},this.uniqueNames.forEach(function(t){e.ensureUniqueIndex(t)})}},S.prototype.update=function(e){var i,r,n;if(Array.isArray(e)){n=e.length,(i=!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0)&&(this.adaptiveBinaryIndices=!1);try{for(r=0;r<n;r+=1)this.update(e[r])}finally{i&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!t.call(e,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var o,s,a,l,c,h=this.get(e.$loki,!0),u=this;if(!h)throw new Error("Trying to update a document not in collection.");o=h[0],a=h[1],s=this.cloneObjects||!this.disableDeltaChangesApi?y(e,this.cloneMethod):e,this.emit("pre-update",e),Object.keys(this.constraints.unique).forEach(function(t){u.constraints.unique[t].update(o,s)}),this.data[a]=s,s!==e&&this.addAutoUpdateObserver(e);for(var d=0;d<this.DynamicViews.length;d++)this.DynamicViews[d].evaluateDocument(a,!1);if(this.adaptiveBinaryIndices){var p=this.binaryIndices;for(l in p)this.adaptiveBinaryIndexUpdate(a,l)}else this.flagBinaryIndexesDirty();return this.idIndex[a]=s.$loki,this.commit(),this.dirty=!0,this.disableChangesApi?this.updateMeta(s,null):this.updateMetaWithChange(s,o),c=this.cloneObjects?y(s,this.cloneMethod):s,this.emit("update",c,o),c}catch(t){throw this.rollback(),this.console.error(t.message),this.emit("error",t),t}}},S.prototype.add=function(e){if("object"!=typeof e)throw new TypeError("Object being added needs to be an object");if(void 0!==e.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1),e.$loki=this.maxId,this.disableMeta||(e.meta.version=0);var i,r=this.constraints.unique;for(i in r)t.call(r,i)&&r[i].set(e);this.idIndex.push(e.$loki),this.data.push(e);for(var n=this.data.length-1,o=this.DynamicViews.length,s=0;s<o;s++)this.DynamicViews[s].evaluateDocument(n,!0);if(this.adaptiveBinaryIndices){var a=this.binaryIndices;for(i in a)this.adaptiveBinaryIndexInsert(n,i)}else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?y(e,this.cloneMethod):e}catch(t){throw this.rollback(),this.console.error(t.message),this.emit("error",t),t}},S.prototype.updateWhere=function(t,e){var i,r=this.where(t),n=0;try{for(;n<r.length;n++)i=e(r[n]),this.update(i)}catch(t){this.rollback(),this.console.error(t.message)}},S.prototype.removeWhere=function(t){var e;"function"==typeof t?(e=this.data.filter(t),this.remove(e)):this.chain().find(t).remove()},S.prototype.removeDataOnly=function(){this.remove(this.data.slice())},S.prototype.removeBatchByPositions=function(t){var e,i,r,n,o=t.length,s={},a=Object.keys(this.binaryIndices).length,l=Object.keys(this.constraints.unique).length,c=this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0,h=this;try{for(this.startTransaction(),r=0;r<o;r++)s[this.idIndex[t[r]]]=!0;if((e=this.DynamicViews.length)>0||a>0||l>0){if(e>0)for(i=0;i<e;i++)this.DynamicViews[i].removeDocument(t);if(this.adaptiveBinaryIndices&&!c){var u,d=this.binaryIndices;for(u in d)this.adaptiveBinaryIndexRemove(t,u)}else this.flagBinaryIndexesDirty();l&&Object.keys(this.constraints.unique).forEach(function(e){for(r=0;r<o;r++)null!==(n=h.data[t[r]])[e]&&void 0!==n[e]&&h.constraints.unique[e].remove(n[e])})}if(!this.disableChangesApi||this.events.delete.length>1)for(r=0;r<o;r++)this.emit("delete",this.data[t[r]]);this.data=this.data.filter(function(t){return!s[t.$loki]}),this.idIndex=this.idIndex.filter(function(t){return!s[t]}),this.adaptiveBinaryIndices&&c&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(t){return this.rollback(),c&&(this.adaptiveBinaryIndices=!0),this.console.error(t.message),this.emit("error",t),null}},S.prototype.removeBatch=function(t){var e,i=t.length,r=this.data.length,n={},o=[];for(e=0;e<r;e++)n[this.data[e].$loki]=e;for(e=0;e<i;e++)"object"==typeof t[e]?o.push(n[t[e].$loki]):o.push(n[t[e]]);this.removeBatchByPositions(o)},S.prototype.remove=function(e){if("number"==typeof e&&(e=this.get(e)),"object"!=typeof e)throw new Error("Parameter is not an object");if(Array.isArray(e))this.removeBatch(e);else{if(!t.call(e,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var i=this.get(e.$loki,!0),r=i[1],n=this;Object.keys(this.constraints.unique).forEach(function(t){null!==e[t]&&void 0!==e[t]&&n.constraints.unique[t].remove(e[t])});for(var o=0;o<this.DynamicViews.length;o++)this.DynamicViews[o].removeDocument(r);if(this.adaptiveBinaryIndices){var s,a=this.binaryIndices;for(s in a)this.adaptiveBinaryIndexRemove(r,s)}else this.flagBinaryIndexesDirty();return this.data.splice(r,1),this.removeAutoUpdateObserver(e),this.idIndex.splice(r,1),this.commit(),this.dirty=!0,this.emit("delete",i[0]),delete e.$loki,delete e.meta,e}catch(t){return this.rollback(),this.console.error(t.message),this.emit("error",t),null}}},S.prototype.get=function(t,e){var i=e||!1,r=this.idIndex,n=r.length-1,o=0,s=o+n>>1;if(t="number"==typeof t?t:parseInt(t,10),isNaN(t))throw new TypeError("Passed id is not an integer");for(;r[o]<r[n];)r[s=o+n>>1]<t?o=s+1:n=s;return n===o&&r[o]===t?i?[this.data[o],o]:this.data[o]:null},S.prototype.getBinaryIndexPosition=function(t,e){var i=this.data[t][e],r=this.binaryIndices[e].values,n=this.calculateRange("$eq",e,i);if(0===n[0]&&-1===n[1])return null;for(var o=n[0],s=n[1],a=o;a<=s;a++)if(r[a]===t)return a;return null},S.prototype.adaptiveBinaryIndexInsert=function(t,e){var i=this.binaryIndices[e].values,r=this.data[t][e];!0===this.serializableIndices&&r instanceof Date&&(this.data[t][e]=r.getTime(),r=this.data[t][e]);var n=0===i.length?0:this.calculateRangeStart(e,r,!0);this.binaryIndices[e].values.splice(n,0,t)},S.prototype.adaptiveBinaryIndexUpdate=function(t,e){var i,r=this.binaryIndices[e].values,n=r.length;for(i=0;i<n&&r[i]!==t;i++);this.binaryIndices[e].values.splice(i,1),this.adaptiveBinaryIndexInsert(t,e)},S.prototype.adaptiveBinaryIndexRemove=function(t,e,i){var r,n,o,s,a,l,c,h=this.binaryIndices[e],u={};if(Array.isArray(t)){if(1!==(s=t.length)){for(o=0;o<s;o++)u[t[o]]=!0;if(h.values=h.values.filter(function(t){return!u[t]}),!0===i)return;var d=t.slice();for(d.sort(function(t,e){return t-e}),r=h.values.length,n=0;n<r;n++){for(a=h.values[n],l=0,o=0;o<s&&a>d[o];o++)l++;h.values[n]-=l}return}t=t[0]}if(null===(c=this.getBinaryIndexPosition(t,e)))return null;if(h.values.splice(c,1),!0!==i)for(r=h.values.length,n=0;n<r;n++)h.values[n]>t&&h.values[n]--},S.prototype.calculateRangeStart=function(t,e,i){var r=this.data,n=this.binaryIndices[t].values,s=0,a=n.length-1,l=0;if(0===n.length)return-1;for(r[n[s]][t],r[n[a]][t];s<a;)l=s+a>>1,o.lt(r[n[l]][t],e,!1)?s=l+1:a=l;var c=s;return o.aeq(e,r[n[c]][t])?c:o.lt(e,r[n[c]][t],!1)?i?c:c-1:i?c+1:c},S.prototype.calculateRangeEnd=function(t,e){var i=this.data,r=this.binaryIndices[t].values,n=0,s=r.length-1,a=0;if(0===r.length)return-1;for(i[r[n]][t],i[r[s]][t];n<s;)a=n+s>>1,o.lt(e,i[r[a]][t],!1)?s=a:n=a+1;var l=s;return o.aeq(e,i[r[l]][t])?l:o.gt(e,i[r[l]][t],!1)?l+1:o.aeq(e,i[r[l-1]][t])?l-1:l},S.prototype.calculateRange=function(t,e,i){var r,n,s,a=this.data,l=this.binaryIndices[e].values,c=l.length-1;if(0===a.length)return[0,-1];var h=a[l[0]][e],u=a[l[c]][e];switch(t){case"$eq":case"$aeq":case"$dteq":if(o.lt(i,h,!1)||o.gt(i,u,!1))return[0,-1];break;case"$gt":if(o.gt(i,u,!0))return[0,-1];if(o.gt(h,i,!1))return[0,c];break;case"$gte":if(o.gt(i,u,!1))return[0,-1];if(o.gt(h,i,!0))return[0,c];break;case"$lt":if(o.lt(i,h,!0))return[0,-1];if(o.lt(u,i,!1))return[0,c];break;case"$lte":if(o.lt(i,h,!1))return[0,-1];if(o.lt(u,i,!0))return[0,c];break;case"$between":return o.gt(i[0],u,!1)?[0,-1]:o.lt(i[1],h,!1)?[0,-1]:(r=this.calculateRangeStart(e,i[0]),s=this.calculateRangeEnd(e,i[1]),r<0&&r++,s>c&&s--,o.gt(a[l[r]][e],i[0],!0)||r++,o.lt(a[l[s]][e],i[1],!0)||s--,s<r?[0,-1]:[r,s]);case"$in":for(var d=[],p=[],f=0,y=i.length;f<y;f++)for(var v=this.calculateRange("$eq",e,i[f]),g=v[0];g<=v[1];g++)void 0===d[g]&&(d[g]=!0,p.push(g));return p}switch(t){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":r=this.calculateRangeStart(e,i),n=a[l[r]][e]}switch(t){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":s=this.calculateRangeEnd(e,i),a[l[s]][e]}switch(t){case"$eq":case"$aeq":case"$dteq":return o.aeq(n,i)?[r,s]:[0,-1];case"$gt":return o.aeq(a[l[s]][e],i)?[s+1,c]:[s,c];case"$gte":return o.aeq(a[l[r]][e],i)?[r,c]:[r+1,c];case"$lt":return o.aeq(a[l[r]][e],i)?[0,r-1]:[0,r];case"$lte":return o.aeq(a[l[s]][e],i)?[0,s]:[0,s-1];default:return[0,a.length-1]}},S.prototype.by=function(t,e){var i;if(void 0===e)return i=this,function(e){return i.by(t,e)};var r=this.constraints.unique[t].get(e);return this.cloneObjects?y(r,this.cloneMethod):r},S.prototype.findOne=function(t){t=t||{};var e=this.chain().find(t,!0).data();return Array.isArray(e)&&0===e.length?null:this.cloneObjects?y(e[0],this.cloneMethod):e[0]},S.prototype.chain=function(t,e){var i=new k(this);return void 0===t?i:i.transform(t,e)},S.prototype.find=function(t){return this.chain().find(t).data()},S.prototype.findOneUnindexed=function(t,e){for(var i=this.data.length;i--;)if(this.data[i][t]===e)return this.data[i];return null},S.prototype.startTransaction=function(){if(this.transactional){this.cachedData=y(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].startTransaction()}},S.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].commit()}},S.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex);for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].rollback()}},S.prototype.async=function(t,e){setTimeout(function(){if("function"!=typeof t)throw new TypeError("Argument passed for async execution is not a function");t(),e()},0)},S.prototype.where=function(t){return this.chain().where(t).data()},S.prototype.mapReduce=function(t,e){try{return e(this.data.map(t))}catch(t){throw t}},S.prototype.eqJoin=function(t,e,i,r,n){return new k(this).eqJoin(t,e,i,r,n)},S.prototype.stages={},S.prototype.getStage=function(t){return this.stages[t]||(this.stages[t]={}),this.stages[t]},S.prototype.commitLog=[],S.prototype.stage=function(t,e){var i=JSON.parse(JSON.stringify(e));return this.getStage(t)[e.$loki]=i,i},S.prototype.commitStage=function(t,e){var i,r=this.getStage(t),n=(new Date).getTime();for(i in r)this.update(r[i]),this.commitLog.push({timestamp:n,message:e,data:JSON.parse(JSON.stringify(r[i]))});this.stages[t]={}},S.prototype.no_op=function(){},S.prototype.extract=function(t){for(var e=0,i=this.data.length,r=D(t),n=[];e<i;e+=1)n.push(_(this.data[e],t,r));return n},S.prototype.max=function(t){return Math.max.apply(null,this.extract(t))},S.prototype.min=function(t){return Math.min.apply(null,this.extract(t))},S.prototype.maxRecord=function(t){for(var e,i=0,r=this.data.length,n=D(t),o={index:0,value:void 0};i<r;i+=1)void 0!==e?e<_(this.data[i],t,n)&&(e=_(this.data[i],t,n),o.index=this.data[i].$loki):(e=_(this.data[i],t,n),o.index=this.data[i].$loki);return o.value=e,o},S.prototype.minRecord=function(t){for(var e,i=0,r=this.data.length,n=D(t),o={index:0,value:void 0};i<r;i+=1)void 0!==e?e>_(this.data[i],t,n)&&(e=_(this.data[i],t,n),o.index=this.data[i].$loki):(e=_(this.data[i],t,n),o.index=this.data[i].$loki);return o.value=e,o},S.prototype.extractNumerical=function(t){return this.extract(t).map(C).filter(Number).filter(function(t){return!isNaN(t)})},S.prototype.avg=function(t){return E(this.extractNumerical(t))},S.prototype.stdDev=function(t){return e=this.extractNumerical(t),i=E(e),r=E(e.map(function(t){var e=t-i,r=e*e;return r})),Math.sqrt(r);var e,i,r},S.prototype.mode=function(t){var e,i,r,n={},o=this.extract(t);for(i in o.forEach(function(t){n[t]?n[t]+=1:n[t]=1}),n)e?e<n[i]&&(r=i):(r=i,e=n[i]);return r},S.prototype.median=function(t){var e=this.extractNumerical(t);e.sort(P);var i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2},z.prototype={keys:[],values:[],sort:function(t,e){return t<e?-1:t>e?1:0},setSort:function(t){this.bs=new $(t)},bs:function(){return new $(this.sort)},set:function(t,e){var i=this.bs(this.keys,t);i.found?this.values[i.index]=e:(this.keys.splice(i.index,0,t),this.values.splice(i.index,0,e))},get:function(t){return this.values[M(this.keys,t,this.sort).index]}},B.prototype.keyMap={},B.prototype.lokiMap={},B.prototype.set=function(t){var e=t[this.field];if(null!=e){if(this.keyMap[e])throw new Error("Duplicate key for property "+this.field+": "+e);this.keyMap[e]=t,this.lokiMap[t.$loki]=e}},B.prototype.get=function(t){return this.keyMap[t]},B.prototype.byId=function(t){return this.keyMap[this.lokiMap[t]]},B.prototype.update=function(t,e){if(this.lokiMap[t.$loki]!==e[this.field]){var i=this.lokiMap[t.$loki];this.set(e),this.keyMap[i]=void 0}else this.keyMap[t[this.field]]=e},B.prototype.remove=function(t){var e=this.keyMap[t];if(null==e)throw new Error("Key is not in unique index: "+this.field);this.keyMap[t]=void 0,this.lokiMap[e.$loki]=void 0},B.prototype.clear=function(){this.keyMap={},this.lokiMap={}},j.prototype={set:function(t,e){this.index[t]?this.index[t].push(e):this.index[t]=[e]},remove:function(t,e){var i=this.index[t];for(var r in i)i[r]==e&&i.splice(r,1);i.length<1&&(this.index[t]=void 0)},get:function(t){return this.index[t]},clear:function(t){this.index={}}},m.LokiOps=p,m.Collection=S,m.KeyValueStore=z,m.LokiMemoryAdapter=b,m.LokiPartitioningAdapter=w,m.LokiLocalStorageAdapter=I,m.LokiFsAdapter=x,m.persistenceAdapters={fs:x,localStorage:I},m.aeq=s,m.lt=a,m.gt=l,m.Comparators=o,m}()})?o.apply(e,s):o)||(t.exports=a)}).call(this,i(4),i(5))},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e){var i,r,n=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var l,c=[],h=!1,u=-1;function d(){h&&l&&(h=!1,l.length?c=l.concat(c):u=-1,c.length&&p())}function p(){if(!h){var t=a(d);h=!0;for(var e=c.length;e;){for(l=c,c=[];++u<e;)l&&l[u].run();u=-1,e=c.length}l=null,h=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function y(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new f(t,e)),1!==c.length||h||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=y,n.addListener=y,n.once=y,n.off=y,n.removeListener=y,n.removeAllListeners=y,n.emit=y,n.prependListener=y,n.prependOnceListener=y,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e,i){var r,n,o;n=[],void 0===(o="function"==typeof(r=function(){return function(){function t(t){if(this.app="loki",void 0!==t&&(this.app=t),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function e(t){this.db=null,this.initializeLokiCatalog(t)}return t.prototype.checkAvailability=function(){return!("undefined"==typeof indexedDB||!indexedDB)},t.prototype.loadDatabase=function(t,i){var r=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(r,t,function(t){if("function"==typeof i){if(0===t.id)return void i(null);i(t.val)}else console.log(t.val)}):this.catalog=new e(function(e){n.catalog=e,n.loadDatabase(t,i)})},t.prototype.loadKey=t.prototype.loadDatabase,t.prototype.saveDatabase=function(t,i,r){var n=this.app,o=this;function s(t){t&&!0===t.success?r(null):r(new Error("Error saving database"))}null!==this.catalog&&null!==this.catalog.db?this.catalog.setAppKey(n,t,i,s):this.catalog=new e(function(e){o.catalog=e,e.setAppKey(n,t,i,s)})},t.prototype.saveKey=t.prototype.saveDatabase,t.prototype.deleteDatabase=function(t,i){var r=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(r,t,function(t){var e=t.id;0!==e?n.catalog.deleteAppKey(e,i):"function"==typeof i&&i({success:!0})}):this.catalog=new e(function(e){n.catalog=e,n.deleteDatabase(t,i)})},t.prototype.deleteKey=t.prototype.deleteDatabase,t.prototype.deleteDatabasePartitions=function(t){var e=this;this.getDatabaseList(function(i){i.forEach(function(i){i.startsWith(t)&&e.deleteDatabase(i)})})},t.prototype.getDatabaseList=function(t){var i=this.app,r=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKeys(i,function(e){for(var i=[],r=0;r<e.length;r++)i.push(e[r].key);"function"==typeof t?t(i):i.forEach(function(t){console.log(t)})}):this.catalog=new e(function(e){r.catalog=e,r.getDatabaseList(t)})},t.prototype.getKeyList=t.prototype.getDatabaseList,t.prototype.getCatalogSummary=function(t){this.app;var i=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAllKeys(function(e){for(var i,r,n,o,s,a=[],l=0;l<e.length;l++)i=e[l],n=i.app||"",o=i.key||"",s=i.val||"",r=2*n.length+2*o.length+s.length+1,a.push({app:i.app,key:i.key,size:r});"function"==typeof t?t(a):a.forEach(function(t){console.log(t)})}):this.catalog=new e(function(e){i.catalog=e,i.getCatalogSummary(t)})},e.prototype.initializeLokiCatalog=function(t){var e=indexedDB.open("LokiCatalog",1),i=this;e.onupgradeneeded=function(t){var e=t.target.result;if(e.objectStoreNames.contains("LokiAKV")&&e.deleteObjectStore("LokiAKV"),!e.objectStoreNames.contains("LokiAKV")){var i=e.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0});i.createIndex("app","app",{unique:!1}),i.createIndex("key","key",{unique:!1}),i.createIndex("appkey","appkey",{unique:!0})}},e.onsuccess=function(e){i.db=e.target.result,"function"==typeof t&&t(i)},e.onerror=function(t){throw t}},e.prototype.getAppKey=function(t,e,i){var r,n=this.db.transaction(["LokiAKV"],"readonly"),o=n.objectStore("LokiAKV"),s=o.index("appkey"),a=t+","+e,l=s.get(a);l.onsuccess=(r=i,function(t){var e=t.target.result;null==e&&(e={id:0,success:!1}),"function"==typeof r?r(e):console.log(e)}),l.onerror=function(t){return function(e){if("function"!=typeof t)throw e;t({id:0,success:!1})}}(i)},e.prototype.getAppKeyById=function(t,e,i){var r=this.db.transaction(["LokiAKV"],"readonly"),n=r.objectStore("LokiAKV"),o=n.get(t);o.onsuccess=function(t,e){return function(i){"function"==typeof e?e(i.target.result,t):console.log(i.target.result)}}(i,e)},e.prototype.setAppKey=function(t,e,i,r){var n,o=this.db.transaction(["LokiAKV"],"readwrite"),s=o.objectStore("LokiAKV"),a=s.index("appkey"),l=t+","+e,c=a.get(l);c.onsuccess=function(n){var o=n.target.result;null==o?o={app:t,key:e,appkey:t+","+e,val:i}:o.val=i;var a,l=s.put(o);l.onerror=(a=r,function(t){"function"==typeof a?a({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(c.error))}),l.onsuccess=function(t){return function(e){"function"==typeof t&&t({success:!0})}}(r)},c.onerror=(n=r,function(t){"function"==typeof n?n({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(c.error))})},e.prototype.deleteAppKey=function(t,e){var i,r=this.db.transaction(["LokiAKV"],"readwrite"),n=r.objectStore("LokiAKV"),o=n.delete(t);o.onsuccess=(i=e,function(t){"function"==typeof i&&i({success:!0})}),o.onerror=function(t){return function(e){"function"==typeof t?t({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(o.error))}}(e)},e.prototype.getAppKeys=function(t,e){var i,r=this.db.transaction(["LokiAKV"],"readonly"),n=r.objectStore("LokiAKV"),o=n.index("app"),s=IDBKeyRange.only(t),a=o.openCursor(s);a.onsuccess=function(t,e){return function(i){var r=i.target.result;if(r){var n=r.value;t.push(n),r.continue()}else"function"==typeof e?e(t):console.log(t)}}([],e),a.onerror=(i=e,function(t){"function"==typeof i?i(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(t))})},e.prototype.getAllKeys=function(t){var e,i=this.db.transaction(["LokiAKV"],"readonly"),r=i.objectStore("LokiAKV"),n=r.openCursor();n.onsuccess=function(t,e){return function(i){var r=i.target.result;if(r){var n=r.value;t.push(n),r.continue()}else"function"==typeof e?e(t):console.log(t)}}([],t),n.onerror=(e=t,function(t){"function"==typeof e&&e(null)})},t}()})?r.apply(e,n):r)||(t.exports=o)},function(t,e,i){var r,n,o;t.exports=(r=i(0),o=(n=r).lib.WordArray,n.enc.Base64={stringify:function(t){var e=t.words,i=t.sigBytes,r=this._map;t.clamp();for(var n=[],o=0;o<i;o+=3)for(var s=(e[o>>>2]>>>24-o%4*8&255)<<16|(e[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|e[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<i;a++)n.push(r.charAt(s>>>6*(3-a)&63));var l=r.charAt(64);if(l)for(;n.length%4;)n.push(l);return n.join("")},parse:function(t){var e=t.length,i=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var n=0;n<i.length;n++)r[i.charCodeAt(n)]=n}var s=i.charAt(64);if(s){var a=t.indexOf(s);-1!==a&&(e=a)}return function(t,e,i){for(var r=[],n=0,s=0;s<e;s++)if(s%4){var a=i[t.charCodeAt(s-1)]<<s%4*2,l=i[t.charCodeAt(s)]>>>6-s%4*2;r[n>>>2]|=(a|l)<<24-n%4*8,n++}return o.create(r,n)}(t,e,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},r.enc.Base64)},function(t,e,i){var r;t.exports=(r=i(0),function(t){var e=r,i=e.lib,n=i.WordArray,o=i.Hasher,s=e.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var l=s.MD5=o.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var i=0;i<16;i++){var r=e+i,n=t[r];t[r]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var o=this._hash.words,s=t[e+0],l=t[e+1],p=t[e+2],f=t[e+3],y=t[e+4],v=t[e+5],g=t[e+6],m=t[e+7],b=t[e+8],w=t[e+9],x=t[e+10],I=t[e+11],k=t[e+12],O=t[e+13],S=t[e+14],D=t[e+15],C=o[0],A=o[1],P=o[2],E=o[3];C=c(C,A,P,E,s,7,a[0]),E=c(E,C,A,P,l,12,a[1]),P=c(P,E,C,A,p,17,a[2]),A=c(A,P,E,C,f,22,a[3]),C=c(C,A,P,E,y,7,a[4]),E=c(E,C,A,P,v,12,a[5]),P=c(P,E,C,A,g,17,a[6]),A=c(A,P,E,C,m,22,a[7]),C=c(C,A,P,E,b,7,a[8]),E=c(E,C,A,P,w,12,a[9]),P=c(P,E,C,A,x,17,a[10]),A=c(A,P,E,C,I,22,a[11]),C=c(C,A,P,E,k,7,a[12]),E=c(E,C,A,P,O,12,a[13]),P=c(P,E,C,A,S,17,a[14]),C=h(C,A=c(A,P,E,C,D,22,a[15]),P,E,l,5,a[16]),E=h(E,C,A,P,g,9,a[17]),P=h(P,E,C,A,I,14,a[18]),A=h(A,P,E,C,s,20,a[19]),C=h(C,A,P,E,v,5,a[20]),E=h(E,C,A,P,x,9,a[21]),P=h(P,E,C,A,D,14,a[22]),A=h(A,P,E,C,y,20,a[23]),C=h(C,A,P,E,w,5,a[24]),E=h(E,C,A,P,S,9,a[25]),P=h(P,E,C,A,f,14,a[26]),A=h(A,P,E,C,b,20,a[27]),C=h(C,A,P,E,O,5,a[28]),E=h(E,C,A,P,p,9,a[29]),P=h(P,E,C,A,m,14,a[30]),C=u(C,A=h(A,P,E,C,k,20,a[31]),P,E,v,4,a[32]),E=u(E,C,A,P,b,11,a[33]),P=u(P,E,C,A,I,16,a[34]),A=u(A,P,E,C,S,23,a[35]),C=u(C,A,P,E,l,4,a[36]),E=u(E,C,A,P,y,11,a[37]),P=u(P,E,C,A,m,16,a[38]),A=u(A,P,E,C,x,23,a[39]),C=u(C,A,P,E,O,4,a[40]),E=u(E,C,A,P,s,11,a[41]),P=u(P,E,C,A,f,16,a[42]),A=u(A,P,E,C,g,23,a[43]),C=u(C,A,P,E,w,4,a[44]),E=u(E,C,A,P,k,11,a[45]),P=u(P,E,C,A,D,16,a[46]),C=d(C,A=u(A,P,E,C,p,23,a[47]),P,E,s,6,a[48]),E=d(E,C,A,P,m,10,a[49]),P=d(P,E,C,A,S,15,a[50]),A=d(A,P,E,C,v,21,a[51]),C=d(C,A,P,E,k,6,a[52]),E=d(E,C,A,P,f,10,a[53]),P=d(P,E,C,A,x,15,a[54]),A=d(A,P,E,C,l,21,a[55]),C=d(C,A,P,E,b,6,a[56]),E=d(E,C,A,P,D,10,a[57]),P=d(P,E,C,A,g,15,a[58]),A=d(A,P,E,C,O,21,a[59]),C=d(C,A,P,E,y,6,a[60]),E=d(E,C,A,P,I,10,a[61]),P=d(P,E,C,A,p,15,a[62]),A=d(A,P,E,C,w,21,a[63]),o[0]=o[0]+C|0,o[1]=o[1]+A|0,o[2]=o[2]+P|0,o[3]=o[3]+E|0},_doFinalize:function(){var e=this._data,i=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;i[n>>>5]|=128<<24-n%32;var o=t.floor(r/4294967296),s=r;i[15+(n+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),i[14+(n+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(i.length+1),this._process();for(var a=this._hash,l=a.words,c=0;c<4;c++){var h=l[c];l[c]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}return a},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});function c(t,e,i,r,n,o,s){var a=t+(e&i|~e&r)+n+s;return(a<<o|a>>>32-o)+e}function h(t,e,i,r,n,o,s){var a=t+(e&r|i&~r)+n+s;return(a<<o|a>>>32-o)+e}function u(t,e,i,r,n,o,s){var a=t+(e^i^r)+n+s;return(a<<o|a>>>32-o)+e}function d(t,e,i,r,n,o,s){var a=t+(i^(e|~r))+n+s;return(a<<o|a>>>32-o)+e}e.MD5=o._createHelper(l),e.HmacMD5=o._createHmacHelper(l)}(Math),r.MD5)},function(t,e,i){var r,n,o,s,a,l,c,h;t.exports=(r=i(0),o=(n=r).lib,s=o.WordArray,a=o.Hasher,l=n.algo,c=[],h=l.SHA1=a.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var i=this._hash.words,r=i[0],n=i[1],o=i[2],s=i[3],a=i[4],l=0;l<80;l++){if(l<16)c[l]=0|t[e+l];else{var h=c[l-3]^c[l-8]^c[l-14]^c[l-16];c[l]=h<<1|h>>>31}var u=(r<<5|r>>>27)+a+c[l];u+=l<20?1518500249+(n&o|~n&s):l<40?1859775393+(n^o^s):l<60?(n&o|n&s|o&s)-1894007588:(n^o^s)-899497514,a=s,s=o,o=n<<30|n>>>2,n=r,r=u}i[0]=i[0]+r|0,i[1]=i[1]+n|0,i[2]=i[2]+o|0,i[3]=i[3]+s|0,i[4]=i[4]+a|0},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=Math.floor(i/4294967296),e[15+(r+64>>>9<<4)]=i,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=a.clone.call(this);return t._hash=this._hash.clone(),t}}),n.SHA1=a._createHelper(h),n.HmacSHA1=a._createHmacHelper(h),r.SHA1)},function(t,e,i){var r,n,o,s,a,l,c;t.exports=(r=i(0),o=(n=r).lib,s=o.Base,a=n.enc,l=a.Utf8,c=n.algo,void(c.HMAC=s.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=l.parse(e));var i=t.blockSize,r=4*i;e.sigBytes>r&&(e=t.finalize(e)),e.clamp();for(var n=this._oKey=e.clone(),o=this._iKey=e.clone(),s=n.words,a=o.words,c=0;c<i;c++)s[c]^=1549556828,a[c]^=909522486;n.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,i=e.finalize(t);e.reset();var r=e.finalize(this._oKey.clone().concat(i));return r}})))},function(t,e,i){var r;t.exports=(r=i(0),i(2),void(r.lib.Cipher||function(t){var e=r,i=e.lib,n=i.Base,o=i.WordArray,s=i.BufferedBlockAlgorithm,a=e.enc,l=(a.Utf8,a.Base64),c=e.algo,h=c.EvpKDF,u=i.Cipher=s.extend({cfg:n.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,i){this.cfg=this.cfg.extend(i),this._xformMode=t,this._key=e,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){t&&this._append(t);var e=this._doFinalize();return e},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?k:w}return function(e){return{encrypt:function(i,r,n){return t(r).encrypt(e,i,r,n)},decrypt:function(i,r,n){return t(r).decrypt(e,i,r,n)}}}}()}),d=(i.StreamCipher=u.extend({_doFinalize:function(){var t=this._process(!0);return t},blockSize:1}),e.mode={}),p=i.BlockCipherMode=n.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),f=d.CBC=function(){var e=p.extend();function i(e,i,r){var n=this._iv;if(n){var o=n;this._iv=t}else var o=this._prevBlock;for(var s=0;s<r;s++)e[i+s]^=o[s]}return e.Encryptor=e.extend({processBlock:function(t,e){var r=this._cipher,n=r.blockSize;i.call(this,t,e,n),r.encryptBlock(t,e),this._prevBlock=t.slice(e,e+n)}}),e.Decryptor=e.extend({processBlock:function(t,e){var r=this._cipher,n=r.blockSize,o=t.slice(e,e+n);r.decryptBlock(t,e),i.call(this,t,e,n),this._prevBlock=o}}),e}(),y=e.pad={},v=y.Pkcs7={pad:function(t,e){for(var i=4*e,r=i-t.sigBytes%i,n=r<<24|r<<16|r<<8|r,s=[],a=0;a<r;a+=4)s.push(n);var l=o.create(s,r);t.concat(l)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},g=(i.BlockCipher=u.extend({cfg:u.cfg.extend({mode:f,padding:v}),reset:function(){u.reset.call(this);var t=this.cfg,e=t.iv,i=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=i.createEncryptor;else{var r=i.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==r?this._mode.init(this,e&&e.words):(this._mode=r.call(i,this,e&&e.words),this._mode.__creator=r)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else{var e=this._process(!0);t.unpad(e)}return e},blockSize:4}),i.CipherParams=n.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}})),m=e.format={},b=m.OpenSSL={stringify:function(t){var e=t.ciphertext,i=t.salt;if(i)var r=o.create([1398893684,1701076831]).concat(i).concat(e);else var r=e;return r.toString(l)},parse:function(t){var e=l.parse(t),i=e.words;if(1398893684==i[0]&&1701076831==i[1]){var r=o.create(i.slice(2,4));i.splice(0,4),e.sigBytes-=16}return g.create({ciphertext:e,salt:r})}},w=i.SerializableCipher=n.extend({cfg:n.extend({format:b}),encrypt:function(t,e,i,r){r=this.cfg.extend(r);var n=t.createEncryptor(i,r),o=n.finalize(e),s=n.cfg;return g.create({ciphertext:o,key:i,iv:s.iv,algorithm:t,mode:s.mode,padding:s.padding,blockSize:t.blockSize,formatter:r.format})},decrypt:function(t,e,i,r){r=this.cfg.extend(r),e=this._parse(e,r.format);var n=t.createDecryptor(i,r).finalize(e.ciphertext);return n},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),x=e.kdf={},I=x.OpenSSL={execute:function(t,e,i,r){r||(r=o.random(8));var n=h.create({keySize:e+i}).compute(t,r),s=o.create(n.words.slice(e),4*i);return n.sigBytes=4*e,g.create({key:n,iv:s,salt:r})}},k=i.PasswordBasedCipher=w.extend({cfg:w.cfg.extend({kdf:I}),encrypt:function(t,e,i,r){var n=(r=this.cfg.extend(r)).kdf.execute(i,t.keySize,t.ivSize);r.iv=n.iv;var o=w.encrypt.call(this,t,e,n.key,r);return o.mixIn(n),o},decrypt:function(t,e,i,r){r=this.cfg.extend(r),e=this._parse(e,r.format);var n=r.kdf.execute(i,t.keySize,t.ivSize,e.salt);r.iv=n.iv;var o=w.decrypt.call(this,t,e,n.key,r);return o}})}()))},function(t,e,i){"use strict";i.r(e);var r=i(3),n=i.n(r),o=function(){function t(t,e,i,r){this.options=i,this.components=t,this.database=e,this.hydrationCompletedCallback=r,this.loki=new n.a("vuex-orm-loki",{env:i.env||"BROWSER",verbose:i.verbose||!1,autoload:i.autoload||!0,autoloadCallback:this.autoLoadCallback.bind(this),autosave:i.autosave||!0,autosaveCallback:i.autosaveCallback,autosaveInterval:i.autosaveInterval||1e3,persistenceMethod:i.persistenceMethod||"localStorage",destructureDelimiter:i.destructureDelimiter||",",serializationMethod:i.serializationMethod||"normal",throttledSaves:i.throttledSaves||!1}),this.loki.loadDatabase()}return t.prototype.autoLoadCallback=function(){var t=this;Object.keys(this.database.models()).forEach(function(e){null===t.loki.getCollection(t.database.models()[e].name)&&t.loki.addCollection(t.database.models()[e].name)}),Object.keys(this.database.models()).forEach(function(e){var i=t.loki.getCollection(t.database.models()[e].name).data,r=t.database.models()[e];i.forEach(function(t){r.insert({data:t})})}),this.hydrationCompletedCallback&&this.hydrationCompletedCallback()},t.setup=function(e,i,r,n){return this.instance=new t(e,i,r,n),this.instance},t.getInstance=function(){return this.instance},t}(),s=i(1),a=i.n(s),l=function(t,e,i,r){return new(i||(i=Promise))(function(n,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})},c=function(t,e){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};var h=function(t,e,i,r){return new(i||(i=Promise))(function(n,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})},u=function(t,e){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};var d=function(t,e,i,r){return new(i||(i=Promise))(function(n,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(s,a)}l((r=r.apply(t,e||[])).next())})},p=function(t,e){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},f={$insert:function(t){return function(e){return l(this,void 0,void 0,function(){var i,r,n,o,s=this;return c(this,function(l){switch(l.label){case 0:return i=this.name,r=e.password,[4,this.insert(e)];case 1:return n=l.sent(),o=t.loki.getCollection(i),n[this.entity].forEach(function(t){var e=t.$toJson();s.AES&&s.AES.forEach(function(t){if(e[t]){if(!r)throw new Error("Cannot insert data. The "+i+" model contains encrypted fields ( "+s.AES+").\n                               The object passed to $insert() method has to have a password property set.");e[t]=function(t,e){try{return a.a.encrypt(JSON.stringify(t),e).toString()}catch(t){throw new Error(t.message)}}(e[t],r)}}),o.insert(e)}),t.loki.saveDatabase(),[2,n]}})})}},$update:function(t){return function(e){return h(this,void 0,void 0,function(){var i,r,n;return u(this,function(o){switch(o.label){case 0:return i=this.name,r=e.password,this.AES&&this.AES.forEach(function(t){if(e.data[t]&&!r)throw new Error('attempted to update an encrypted field "'+t+'" without providing password');e.data[t]&&(e.data[t]=function(t,e){try{return a.a.encrypt(JSON.stringify(t),e).toString()}catch(t){throw new Error(t.message)}}(e.data[t],r))}),n=t.loki.getCollection(i),"function"==typeof e.where?n.updateWhere(e.where,function(t){return Object.assign(t,e.data)}):console.error("data has not been put into loki, use vuexorm where() filter function when you do updates:\n\n        User.update({\n          where: (record) => {\n            return record.id === 2\n          },\n\n          data: { age: 24 }\n        })\n\n      "),[4,this.update(e)];case 1:return o.sent(),t.loki.saveDatabase(),[2]}})})}},$delete:function(t){return function(e){return d(this,void 0,void 0,function(){var i,r,n;return p(this,function(o){switch(o.label){case 0:return i=this.name,r=t.loki.getCollection(i),(n={})[this.localKey()]=e,r.findAndRemove(n),[4,this.delete(e)];case 1:return o.sent(),t.loki.saveDatabase(),[2]}})})}},$find:function(t){return function(e){var i=this.name,r=t.loki.getCollection(i),n={};return n[this.localKey()]=e,r.find(n)}},$all:function(t){return function(e){var i=this.name;return t.loki.getCollection(i).find()}}},y=function(){function t(e,i,r,n){o.setup(e,i,r,n),t.setupModelMethods()}return t.prototype.getContext=function(){return o.getInstance()},t.setupModelMethods=function(){var t=o.getInstance(),e=t.components.Model,i=f.$insert,r=f.$update,n=f.$delete,s=f.$find,a=f.$all;e.$insert=i(t),e.$update=r(t),e.$delete=n(t),e.$find=s(t),e.$all=a(t)},t}(),v=function(){function t(){}return t.install=function(e,i,r){return t.instance=new y(e,i.database,i.options,i.hydrationCompletedCallback),t.instance},t}();e.default=v}])});